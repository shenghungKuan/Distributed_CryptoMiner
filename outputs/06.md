## Test 06: Memory Leak Check [1 pts]

```

if ! ( which valgrind &> /dev/null ); then
    # "valgrind is not installed. Please install (as root) with:"
    # "pacman -Sy valgrind"
    test_end 1
fi

leak_output=$(timeout 10 valgrind \
    --trace-children=yes \
    --child-silent-after-fork=no \
    --leak-check=full \
    --track-fds=yes \
    --show-leak-kinds=all \
    --track-origins=yes \
    ./miner 8 10 'Memory Leak Check' 2>&1)

echo "${leak_output}"
==1347336== Memcheck, a memory error detector
==1347336== Copyright (C) 2002-2022, and GNU GPL'd, by Julian Seward et al.
==1347336== Using Valgrind-3.20.0 and LibVEX; rerun with -h for copyright info
==1347336== Command: ./miner 8 10 Memory\ Leak\ Check
==1347336== 
Number of threads: 8
  Difficulty Mask: 00000000001111111111111111111111
       Block data: [Memory Leak Check]

----------- Starting up miner threads!  -----------

Solution found by thread 0:
Nonce: 187
Hash: 0027453A6E44EFA916296C6B7BC77F507A70D9D5
187 hashes in 0.82s (228.50 hashes/sec)
==1347336== 
==1347336== FILE DESCRIPTORS: 7 open (3 std) at exit.
==1347336== Open file descriptor 23: /dev/pts/ptmx
==1347336==    <inherited from parent>
==1347336== 
==1347336== Open file descriptor 22: /dev/pts/ptmx
==1347336==    <inherited from parent>
==1347336== 
==1347336== Open file descriptor 21: /home/skuan/.local/share/code-server/logs/20230425T154229/remoteagent.log
==1347336==    <inherited from parent>
==1347336== 
==1347336== Open file descriptor 19: /home/skuan/.local/share/code-server/logs/20230425T154229/ptyhost.log
==1347336==    <inherited from parent>
==1347336== 
==1347336== 
==1347336== HEAP SUMMARY:
==1347336==     in use at exit: 0 bytes in 0 blocks
==1347336==   total heap usage: 196 allocs, 196 frees, 13,378 bytes allocated
==1347336== 
==1347336== All heap blocks were freed -- no leaks are possible
==1347336== 
==1347336== For lists of detected and suppressed errors, rerun with: -s
==1347336== ERROR SUMMARY: 0 errors from 0 contexts (suppressed: 0 from 0)

# Check for open FDs
awk "${fd_check}" <<< "${leak_output}" \
    | grep -i '==[0-9]*==.*file descriptor' && test_end 1

# Make sure there were no leaks possible
grep -i '==[0-9]*==.*no leaks are possible' \
    <<< "${leak_output}" || test_end 1
==1347336== All heap blocks were freed -- no leaks are possible

# If none of the conditions were triggered above, the test passes.
test_end 0
```

